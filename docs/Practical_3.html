<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mikis Stasinopoulos">
<meta name="author" content="Bob Rigby">
<meta name="author" content="Gillian Heller">
<meta name="author" content="Fernanda De Bastiani">
<meta name="author" content="Niki Umlauf">

<title>GAMLSS Short Course - Practical 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">GAMLSS Short Course</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.qmd"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-stylometric-data." id="toc-the-stylometric-data." class="nav-link active" data-scroll-target="#the-stylometric-data.">The stylometric data.</a></li>
  <li><a href="#the-fish-species-data." id="toc-the-fish-species-data." class="nav-link" data-scroll-target="#the-fish-species-data.">The fish species data.</a></li>
  <li><a href="#finding-the-best-distribution" id="toc-finding-the-best-distribution" class="nav-link" data-scroll-target="#finding-the-best-distribution">Finding the best distribution</a>
  <ul class="collapse">
  <li><a href="#using-aic" id="toc-using-aic" class="nav-link" data-scroll-target="#using-aic">Using AIC</a></li>
  </ul></li>
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics">Diagnostics</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Practical_3.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Practical 3</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Mikis Stasinopoulos </p>
             <p>Bob Rigby </p>
             <p>Gillian Heller </p>
             <p>Fernanda De Bastiani </p>
             <p>Niki Umlauf </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="the-stylometric-data." class="level2">
<h2 class="anchored" data-anchor-id="the-stylometric-data.">The stylometric data.</h2>
<ul>
<li><p><strong>R</strong> data file:] in package <code>gamlss.data</code> of dimensions <span class="math inline">64 \times 2</span></p>
<ul>
<li><code>word</code>: number of times a word appears in a single text</li>
<li><code>freq</code>: frequency of the number of times a word appears in a text <em>purpose</em> to demonstrate the fitting of a truncated discrete distribution.</li>
</ul></li>
</ul>
<p>Note that the response variable <code>word</code> is (left) truncated at 0.</p>
<ul>
<li>Load the data and plot them.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.tr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.ggplots)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(stylo)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(freq <span class="sc">~</span> word, <span class="at">data =</span> stylo, <span class="at">type =</span> <span class="st">"h"</span>, <span class="at">xlim =</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">22</span>), <span class="at">xlab =</span> <span class="st">"no of times"</span>, <span class="at">ylab =</span>  <span class="st">"frequencies"</span>, <span class="at">col =</span> <span class="st">"blue"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># in ggplots</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">ggplot</span>(<span class="at">data=</span>stylo, <span class="fu">aes</span>(<span class="at">x=</span>word, <span class="at">y=</span>freq))<span class="sc">+</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_segment</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>word, <span class="at">y=</span>freq, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xend =</span> word, <span class="at">yend =</span> <span class="dv">0</span>),  <span class="at">size=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Create different truncated at zero count data distributions (<code>PO</code>, <code>NBII</code>, <code>DEL</code>, <code>SICHEL</code>, for example:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.tr)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gen.trun</span>(<span class="at">par =</span> <span class="dv">0</span>, <span class="at">family =</span> PO, <span class="at">type =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A truncated family of distributions from PO has been generated 
 and saved under the names:  
 dPOtr pPOtr qPOtr rPOtr POtr 
The type of truncation is left 
 and the truncation parameter is 0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gen.trun</span>(<span class="at">par =</span> <span class="dv">0</span>, <span class="at">family =</span> PO, <span class="at">type =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A truncated family of distributions from PO has been generated 
 and saved under the names:  
 dPOtr pPOtr qPOtr rPOtr POtr 
The type of truncation is left 
 and the truncation parameter is 0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gen.trun</span>(<span class="at">par =</span> <span class="dv">0</span>, <span class="at">family =</span> NBII, <span class="at">type =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A truncated family of distributions from NBII has been generated 
 and saved under the names:  
 dNBIItr pNBIItr qNBIItr rNBIItr NBIItr 
The type of truncation is left 
 and the truncation parameter is 0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gen.trun</span>(<span class="at">par =</span> <span class="dv">0</span>, <span class="at">family =</span> DEL, <span class="at">type =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A truncated family of distributions from DEL has been generated 
 and saved under the names:  
 dDELtr pDELtr qDELtr rDELtr DELtr 
The type of truncation is left 
 and the truncation parameter is 0  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gen.trun</span>(<span class="at">par =</span> <span class="dv">0</span>, <span class="at">family =</span> SICHEL, <span class="at">type =</span> <span class="st">"left"</span>,<span class="at">delta =</span> <span class="fl">0.001</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A truncated family of distributions from SICHEL has been generated 
 and saved under the names:  
 dSICHELtr pSICHELtr qSICHELtr rSICHELtr SICHELtr 
The type of truncation is left 
 and the truncation parameter is 0  </code></pre>
</div>
</div>
<ul>
<li>Fit the different truncated distributions, for example:</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a> mPO <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(word <span class="sc">~</span> <span class="dv">1</span>, <span class="at">weights =</span> freq, <span class="at">data =</span> stylo, </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">family =</span> POtr, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>mNBII <span class="ot">&lt;-</span> <span class="fu">gamlss</span>(word <span class="sc">~</span> <span class="dv">1</span>, <span class="at">weights =</span> freq, <span class="at">data =</span> stylo,              </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> NBIItr, <span class="at">n.cyc =</span> <span class="dv">50</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>mDEL <span class="ot">&lt;-</span> <span class="fu">gamlss</span>(word <span class="sc">~</span> <span class="dv">1</span>, <span class="at">weights =</span> freq, <span class="at">data =</span> stylo,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> DELtr, <span class="at">n.cyc =</span> <span class="dv">50</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>mSI <span class="ot">&lt;-</span> <span class="fu">gamlss</span>(word <span class="sc">~</span> <span class="dv">1</span>, <span class="at">weights =</span> freq, <span class="at">data =</span> stylo,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> SICHELtr, <span class="at">n.cyc =</span> <span class="dv">50</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Compare the distributions using GAIC.% as in Exercise 4(e) of this Chapter.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">GAIC</span>(mPO, mNBII, mDEL, mSI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           AIC df
mSI   5148.473  3
mDEL  5160.581  3
mNBII 5311.628  2
mPO   9207.459  1</code></pre>
</div>
</div>
<ul>
<li>Check the residuals of the chosen model using <code>resid_plots()</code> and <code>resid_wp()</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wp</span>(mSI)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>Plot the fitted distributions using <code>histDist()</code>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  mPO <span class="ot">&lt;-</span> <span class="fu">histDist</span>(stylo<span class="sc">$</span>word, <span class="at">family =</span> POtr, <span class="at">freq =</span> stylo<span class="sc">$</span>freq,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">"(b) Poisson"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.65</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">26</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  mNBII <span class="ot">&lt;-</span> <span class="fu">histDist</span>(stylo<span class="sc">$</span>word, <span class="at">family =</span> NBIItr, <span class="at">freq =</span> stylo<span class="sc">$</span>freq,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"(c) negative binomial II"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.65</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>          <span class="dv">26</span>), <span class="at">start.from =</span> mNBII, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in MLE(ll2, start = list(eta.mu = eta.mu, eta.sigma = eta.sigma), :
possible convergence problem: optim gave code=1 false convergence (8)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>  mDEL <span class="ot">&lt;-</span> <span class="fu">histDist</span>(stylo<span class="sc">$</span>word, <span class="at">family =</span> DELtr, <span class="at">freq =</span> stylo<span class="sc">$</span>freq,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"(c) Delaporte"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.65</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">26</span>),</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">start.from =</span> mDEL, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  mSI <span class="ot">&lt;-</span> <span class="fu">histDist</span>(stylo<span class="sc">$</span>word, <span class="at">family =</span> SICHELtr, <span class="at">freq =</span> stylo<span class="sc">$</span>freq,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">"(d) Sichel"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.65</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">26</span>),</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">start.from =</span> mSI, <span class="at">trace =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(op)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-fish-species-data." class="level2">
<h2 class="anchored" data-anchor-id="the-fish-species-data.">The fish species data.</h2>
<ul>
<li><strong>R</strong> data file: <code>species</code> in package <code>gamlss.data</code> of dimension <span class="math inline">70 \times 2</span><br>
</li>
<li><code>fish</code>: the number of different species in 70 lakes in the world</li>
<li><code>lake</code>: the lake area</li>
</ul>
<!-- \item[purpose:] to demonstrate results of fitting using RS, CG and `mixed' algorithms  -->
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss2)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>species, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">log</span>(lake), <span class="at">y=</span>fish))<span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The number of different fish species <code>fish</code> was recorded for 70 lakes of the world together with explanatory variable <code>x = log lake area</code>.</p>
<p>The data were analysed by Stein and Juritz (1988) using a Poisson inverse Gaussian (<code>PIG</code><span class="math inline">(\mu, \sigma)</span>) distribution for <code>fish</code>, with a linear model in <code>log(lake)</code> for <span class="math inline">\log \mu</span>, and a constant for <span class="math inline">\sigma</span>. Rigby analysed this data set and identified the following questions that need to be answered. Note that the same questions could apply to any regression situation where the response variable is a count and <code>x</code> represents a set of explanatory variables.</p>
<ul>
<li>How does the mean of the response variable depend on texttt{x}?</li>
<li>Is the response variable overdispersed Poisson?</li>
<li>How does the variance of the response variable depend on its mean?</li>
<li>What is the conditional distribution of the response variable given texttt{x}?</li>
<li>Do the scale and shape parameters of the response variable distribution depend on texttt{x}?</li>
</ul>
<p>Here we will model the data using different discrete distributions and consider flexible models for the distribution parameters, where any or all of them may depend on the explanatory variable <code>log(lake)</code>. We start by fitting all available count distributions to the data including:</p>
<ul>
<li>Poisson (<code>PO</code>),</li>
<li>double Poisson (<code>DPO</code>),</li>
<li>negative binomial types I and II (<code>NBI</code>, <code>NBII</code>),</li>
<li>Poisson inverse Gaussian (<code>PIG</code>),</li>
<li>Delaporte (<code>DEL</code>) and</li>
<li>Sichel (‘SICHEL’)</li>
</ul>
<p>We first use a linear model for <code>x=log(lake</code> and using <code>chooseDist()</code> we then trying to find an appropriate distribution for the response. Note that <span class="math inline">T1</span> is a table containing as colunms different GAIC criteria in this case <span class="math inline">k=2, 3.84, log(n)</span> representing AIC, <span class="math inline">\chi^2</span> and BIC respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>mpo <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(fish<span class="sc">~</span><span class="fu">log</span>(lake), <span class="at">data=</span>species, <span class="at">family=</span>PO, <span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>T1 <span class="ot">&lt;-</span> <span class="fu">chooseDist</span>(mpo, <span class="at">type=</span><span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>minimum GAIC(k= 2 ) family: GPO 
minimum GAIC(k= 3.84 ) family: GPO 
minimum GAIC(k= 4.25 ) family: GPO </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>T1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 2      3.84      4.25
PO       1900.1562 1903.8362 1904.6562
GEOM      643.6793  647.3593  648.1793
GEOMo     643.6793  647.3593  648.1793
LG        734.1511  737.8311  738.6511
YULE      948.9285  952.6085  953.4285
ZIPF      794.4613  798.1413  798.9613
WARING    646.0455  651.5655  652.7955
GPO       617.9459  623.4659  624.6959
DPO       654.1618  659.6818  660.9118
BNB       629.3020  636.6620  638.3020
NBF       624.4985  631.8585  633.4985
NBI       625.8444  631.3644  632.5944
NBII      647.5360  653.0560  654.2860
PIG       623.4668  628.9868  630.2168
ZIP      1902.5385 1908.0585 1909.2885
ZIP2     1946.3458 1951.8658 1953.0958
ZAP      1902.5370 1908.0570 1909.2870
ZALG      732.7409  738.2609  739.4909
DEL       626.4540  633.8140  635.4540
ZAZIPF    796.4613  801.9813  803.2113
SI        625.6528  633.0128  634.6528
SICHEL    625.3930  632.7530  634.3930
ZANBI     626.0870  633.4470  635.0870
ZAPIG     625.3754  632.7354  634.3754
ZINBI     627.8453  635.2053  636.8453
ZIPIG     625.4668  632.8268  634.4668
ZINBF     626.4985  635.6985  637.7485
ZABNB           NA        NA        NA
ZASICHEL        NA        NA        NA
ZINBF     626.4985  635.6985  637.7485
ZIBNB     631.3020  640.5020  642.5520
ZISICHEL  627.3930  636.5930  638.6430</code></pre>
</div>
</div>
<p>The folowing command orders the models from best to worst (here we use <code>column=3</code> for BIC);</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getOrder</span>(T1, <span class="at">column=</span><span class="dv">3</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAIG with k= 4.25 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     GPO      PIG      NBI      NBF    ZAPIG 
624.6959 630.2168 632.5944 633.4985 634.3754 </code></pre>
</div>
</div>
<p>Now we fit a quadratic polynomial in <code>x=log(lake</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>mpo <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(fish<span class="sc">~</span><span class="fu">poly</span>(<span class="fu">log</span>(lake),<span class="dv">2</span>), <span class="at">data=</span>species, <span class="at">family=</span>PO, <span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>T2 <span class="ot">&lt;-</span> <span class="fu">chooseDist</span>(mpo, <span class="at">type=</span><span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>minimum GAIC(k= 2 ) family: GPO 
minimum GAIC(k= 3.84 ) family: GPO 
minimum GAIC(k= 4.25 ) family: GPO </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getOrder</span>(T2, <span class="at">column=</span><span class="dv">3</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAIG with k= 4.25 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     GPO      PIG      NBF      NBI   SICHEL 
623.3655 630.3456 630.6970 631.3173 634.3515 </code></pre>
</div>
</div>
<p>Now we fit a smooth function in <code>x=log(lake)</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mpo <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(fish<span class="sc">~</span><span class="fu">s</span>(<span class="fu">log</span>(lake)), <span class="at">data=</span>species, <span class="at">family=</span>PO, <span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>T3 <span class="ot">&lt;-</span> <span class="fu">chooseDist</span>(mpo, <span class="at">type=</span><span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>minimum GAIC(k= 2 ) family: GPO 
minimum GAIC(k= 3.84 ) family: GPO 
minimum GAIC(k= 4.25 ) family: GPO </code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getOrder</span>(T3, <span class="at">column=</span><span class="dv">3</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAIG with k= 4.25 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     GPO      PIG      NBF      NBI       SI 
623.3202 629.2932 630.6454 631.5157 633.2659 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># getOrder(T1, column=3)[1:5] </span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># getOrder(T2, column=3)[1:5] </span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># getOrder(T3, column=3)[1:5]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- ```{r} -->
<!-- mpo <- gamlss(fish~log(lake), data=species, family=PO) -->
<!-- T11 <- chooseDist(mpo, type="count") -->
<!-- getOrder(T1, column=3)[1:5]  -->
<!-- getOrder(T11, column=3)[1:5]  -->
<!-- ``` -->
<p>The Poisson distribution model has a very large BIC compared to the rest of the distributions and do not appears in the best 5 fits. We can conclude that the data are over-dispersed. The quadratic polynomial in <code>log(lake)</code> seems to fit slightly better than the linear term across the distributions and the smoothing only improves BIC marginally. The best distribution at this stage is the generalized Poisson <code>GPO</code> model with a quadratic polynomial in <code>log(lake)</code>. <!-- The fitted smooth function do not improve the fit for the quadratic polynomial in `log(lake)`.  --></p>
<p>We will try now to model all other parameters as a linear function of `log(lake). (Note that the Poisson distribution has only the <span class="math inline">\mu</span> parameter but we include the linear terms for all parameters in the formula so it can fitted for the more compicated distributions).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>mpo <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(fish<span class="sc">~</span><span class="fu">poly</span>(<span class="fu">log</span>(lake),<span class="dv">2</span>)<span class="sc">|</span><span class="fu">log</span>(lake)<span class="sc">|</span><span class="fu">log</span>(lake), <span class="at">data=</span>species, <span class="at">family=</span>PO, <span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>T21 <span class="ot">&lt;-</span> <span class="fu">chooseDist</span>(mpo, <span class="at">type=</span><span class="st">"count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>minimum GAIC(k= 2 ) family: ZANBI 
minimum GAIC(k= 3.84 ) family: ZANBI 
minimum GAIC(k= 4.25 ) family: ZANBI </code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getOrder</span>(T21, <span class="at">column=</span><span class="dv">3</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAIG with k= 4.25 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     ZANBI        PIG        GPO        NBI       NBII 
-1847.7316   623.6168   625.0332   626.2065   626.3750 </code></pre>
</div>
</div>
<p>Something radically went wrong with<code>ZANBI</code> distribution so let ignore it competely.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getOrder</span>(T21, <span class="at">column=</span><span class="dv">3</span>)[<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAIG with k= 4.25 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     PIG      GPO      NBI     NBII   SICHEL 
623.6168 625.0332 626.2065 626.3750 627.3837 </code></pre>
</div>
</div>
<!-- try proper `gamlss`; -->
<!-- ```{r} -->
<!-- #| warning: false -->
<!-- mpo <- gamlss(fish~poly(log(lake),2),~log(lake),~log(lake), data=species, family=PO, trace=FALSE) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- T22 <- chooseDist(mpo, type="count") -->
<!-- getOrder(T22, column=3)[1:5]  -->
<!-- ``` -->
<p>Modelling <span class="math inline">\log(\sigma)</span> as a linear function of <code>x</code> shows that the <code>PIG</code> distribution is the best but in fact its BIC is not better than the BIC of the <code>GPO</code> distribution fitted earlier.</p>
<p>Now let us look at the shape of the fitted distributions and the residual of the two best model <code>PIC</code> and <code>GPO</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss2)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>mGPO <span class="ot">&lt;-</span><span class="fu">gamlss2</span>(fish<span class="sc">~</span><span class="fu">poly</span>(<span class="fu">log</span>(lake),<span class="dv">2</span>), <span class="at">data=</span>species, <span class="at">family=</span>GPO, <span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>mPIG <span class="ot">&lt;-</span><span class="fu">gamlss2</span>(fish<span class="sc">~</span><span class="fu">poly</span>(<span class="fu">log</span>(lake),<span class="dv">2</span>)<span class="sc">|</span><span class="fu">log</span>(lake), <span class="at">data=</span>species, <span class="at">family=</span>PIG, <span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.ggplots)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted_pdf</span>(mGPO, <span class="at">obs=</span><span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">67</span>), <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">110</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted_pdf</span>(mPIG, <span class="at">obs=</span><span class="fu">c</span>(<span class="dv">40</span>,<span class="dv">67</span>), <span class="at">from=</span><span class="dv">0</span>, <span class="at">to=</span><span class="dv">110</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Similar shape as expected. Now look at residuals from the two models</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.ggplots)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_wp</span>(mGPO, mPIG)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Practical_3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="finding-the-best-distribution" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-best-distribution">Finding the best distribution</h2>
<p>From the lecture we have that in order to select an appropriate ditribution from the data we have to:</p>
<ul>
<li>Select an appropriate class of distributions following the range of the resposnse.</li>
<li>Use the function <code>chooseDist()</code> to fit a “linear” models for both <span class="math inline">\mu</span> and <span class="math inline">\sigma</span></li>
<li>Use GAIC to finds the best fit</li>
<li>Use model diagnostics to check the distribution</li>
</ul>
<p>Here we apply tis to the <code>rent99</code> data</p>
<p>The respoose <code>rent</code> is defined in the positive real so we use</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss2)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>da <span class="ot">&lt;-</span> rent99[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">9</span>)]</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># fit a linear model with all variables above to both mu and sigma</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a> m1 <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(rent<span class="sc">~</span>.<span class="sc">|</span>., <span class="at">data=</span>da, <span class="at">family=</span>GA,<span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a> M1 <span class="ot">&lt;-</span> <span class="fu">chooseDist</span>(m1, <span class="at">type=</span><span class="st">"realplus"</span>, <span class="at">parallel=</span><span class="st">"snow"</span>, <span class="at">ncpus=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>minimum GAIC(k= 2 ) family: BCTo 
minimum GAIC(k= 3.84 ) family: BCCGo 
minimum GAIC(k= 8.03 ) family: BCCGo </code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a> M1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                2     3.84     8.03
EXP      43706.40 43721.12 43754.64
GA       38485.04 38514.48 38581.52
IG       38695.74 38725.18 38792.22
LOGNO    38633.88 38663.32 38730.36
LOGNO2   38633.88 38663.32 38730.36
WEI      38517.73 38547.17 38614.21
WEI2     38905.86 38935.30 39002.34
WEI3     38518.44 38547.88 38614.92
IGAMMA   66406.55 66435.99 66503.03
PARETO2  44005.87 44035.31 44102.35
PARETO2o 46106.69 46136.13 46203.17
GP       44005.87 44035.31 44102.35
BCCG     38474.04 38505.32 38576.55
BCCGo    38435.48 38466.76 38537.99
exGAUS   38513.62 38544.90 38616.13
GG       38448.83 38480.11 38551.34
GIG      38548.69 38579.97 38651.20
LNO            NA       NA       NA
BCTo     38435.06 38468.18 38543.60
BCT      38475.64 38508.76 38584.18
BCPEo    38436.67 38469.79 38545.21
BCPE     38476.00 38509.12 38584.54
GB2      38469.66 38502.78 38578.20</code></pre>
</div>
</div>
<section id="using-aic" class="level3">
<h3 class="anchored" data-anchor-id="using-aic">Using AIC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getOrder</span>(M1, <span class="at">column=</span><span class="dv">1</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GAIG with k= 2 </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    BCTo    BCCGo    BCPEo       GG      GB2     BCCG      BCT     BCPE 
38435.06 38435.48 38436.67 38448.83 38469.66 38474.04 38475.64 38476.00 
      GA   exGAUS      WEI     WEI3      GIG    LOGNO   LOGNO2       IG 
38485.04 38513.62 38517.73 38518.44 38548.69 38633.88 38633.88 38695.74 
    WEI2      EXP  PARETO2       GP PARETO2o   IGAMMA      LNO 
38905.86 43706.40 44005.87 44005.87 46106.69 66406.55       NA </code></pre>
</div>
</div>
</section>
</section>
<section id="diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="diagnostics">Diagnostics</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>da <span class="ot">&lt;-</span> rent99[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">9</span>)]</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>mGA <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(rent<span class="sc">~</span>.<span class="sc">|</span>., <span class="at">data=</span>da, <span class="at">family=</span>GA,<span class="at">trace=</span><span class="cn">FALSE</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>mBCTo <span class="ot">&lt;-</span> <span class="fu">gamlss2</span>(rent<span class="sc">~</span>.<span class="sc">|</span>., <span class="at">data=</span>da, <span class="at">family=</span>BCTo,<span class="at">trace=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gamlss.ggplots)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">model_wp</span>(mGA, mBCTo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-model_diag6" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-model_diag6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Practical_3_files/figure-html/fig-model_diag6-1.png" id="fig-model_diag6" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-model_diag6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>